<!DOCTYPE html>
<html>
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
    </script>

    <script>
      function render_page(files) {
        var tbl = $('<table></table>').attr({id: "top-table", border:1});
        $("#top-div").html(tbl)

          for(var i in files) {
            var file = files[i]
              var row = $('<tr></tr>').appendTo($("#top-table"));
            var td_filename = $('<td></td>').appendTo(row);

            var href_filename = $('<a></a>').text(file.filename).prop({href: file.url, target: "_blank"}).appendTo(td_filename)
              $('<td></td>').text(file.size).appendTo(row);

            var td_starred = $('<td></td>').appendTo(row);    
            $('<input type="checkbox"/>').prop({checked: file.starred, id: file.id}).appendTo(td_starred);

            $('<td></td>').text(file.desc).appendTo(row);    
          }

        $(':checkbox').change(function () {
          var cb = $(this)[0]
            google.script.run.set_starred(cb.id, cb.checked)
        });   
      }
      $(function() {
        var jqxhr = $.post( "https://script.google.com/macros/s/AKfycbyQZraBEh4TDdNkqr3ydlQzxw9TzHs1pyxy5Sw-CMuZytl-Nb0p/exec", function(files) {
          render_page(files)
        })
        .done(function() {
          console.log( "second success" );
        })
        .fail(function() {
          console.log( "error" );
        })
        .always(function() {
          console.log( "finished" );
        });
      })
    </script>
  </head>
  <body>
    <div id="top-div">Loading...</div>
  </body>
</html>

